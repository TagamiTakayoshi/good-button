<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>動的いいねボタン</title>
<style>
  .like-button {
    font-size: 40px;  /* ボタンを一回り大きく */
    background-color: transparent;
    color: #ccc;
    border: 2px solid #ccc;
    border-radius: 8px;
    padding: 12px 24px;  /* パディング調整 */
    cursor: pointer;
    transition: all 0.3s ease;
    margin-right: 10px;  /* ボタンとカウントの間隔 */
  }

  .like-button:hover {
    color: #e91e63;
    border-color: #e91e63;
  }

  .like-button.liked {
    color: #e91e63;
    border-color: #e91e63;
  }

  .like-count {
    display: none;  /* 初期状態で非表示 */
    font-size: 14px;
    color: #333;
    margin-top: 12px; /* カウントとボタンの位置調整 */
  }

  .like-count.visible {
    display: block; /* ボタンクリックで表示 */
  }

  /* 横並びにするためのスタイル */
  .like-container {
    display: flex;
    align-items: center;  /* ボタンとカウントを縦中央に合わせる */
    margin-bottom: 20px;
  }
</style>
</head>
<body>
  <div id="like-container">読み込み中...</div>

  <script>
    const baseUrl = 'https://script.google.com/macros/s/AKfycbwL_3gxmoT4P056qSwi2TBhFAd00bxPgqis53T8p1w3bZXi-RhMeXadgz3y_rFevwaG0g/exec';
    const container = document.getElementById('like-container');
    container.innerHTML = ''; // ローディングメッセージ消す

    fetch(`${baseUrl}?all=true`)
      .then(res => res.json())
      .then(data => {
        for (const id in data) {
          const button = document.createElement('button');
          button.className = 'like-button';
          button.dataset.id = id;
          button.innerText = ` 👍🏼 Good!`;

          const count = document.createElement('p');
          count.id = `count-${id}`;
          count.className = 'like-count';
          count.innerText = `good: ${data[id]}`;

          const likeContainer = document.createElement('div');
          likeContainer.className = 'like-container';
          likeContainer.appendChild(button);
          likeContainer.appendChild(count);

          container.appendChild(likeContainer);

          button.addEventListener('click', () => {
            button.classList.add('liked');
            fetch(`${baseUrl}?id=${id}`, { method: 'POST' })
              .then(res => res.json())
              .then(updated => {
                count.textContent = `good: ${updated.count}`;
                count.classList.add('visible'); // ← 初回クリックで表示
              });
          });
        }
      })
      .catch(err => {
        container.innerHTML = '読み込み失敗しました😢';
        console.error(err);
      });
  </script>
</body>
</html>
